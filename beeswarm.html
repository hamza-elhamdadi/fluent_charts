<!doctype html>
<html>
  <head>
    <title>Vega-Lite Bar Chart</title>
    <meta charset="utf-8" />

    <script src="https://cdn.jsdelivr.net/npm/vega@5.30.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5.21.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6.26.0"></script>

    <style media="screen">
      /* Add space between Vega-Embed links  */
      .vega-actions a {
        margin-right: 5px;
      }
    </style>
  </head>
  <body>
    <!-- <h1>Template for Embedding Vega-Lite Visualization</h1> -->
    <!-- Container for the visualization -->
    <div id="vis"></div>


    <script>
        let plotColor = "#222";
        let dotColor = "#888";

        let valence = "a";
        let barOrder = "h";

        let datafile = valence + barOrder;
        let categories = (valence === "a") 
                            ? ["A", "B"] 
                            : (valence === "p") 
                                ? ["First Class", "Seventh Heaven"] 
                                : ["Abduction", "Motormouth"];
        
        let heights = (barOrder === "l") ? [1, 3] : [3, 1];
        

        let avgValues = [ { "x": categories[0], "y": heights[0] }, { "x": categories[1], "y": heights[1]  } ]


        let i = 5

        let plotWidth = 800, plotHeight = 400, tfSize = 20,  afSize = 18;
        // let plotWidth = 264, plotHeight = 132, tfSize = 6.6, afSize = 5.94;

        // Assign the specification to a local variable vlSpec.
        var vlSpec = {
            "$schema": "https://vega.github.io/schema/vega/v5.json",
            "description": "A beeswarm chart example that uses a force-directed layout to group items by category.",
            "width": plotWidth,
            "height": plotHeight,
            "padding": {"left": 45, "right": 5, "top": 54, "bottom": 55},
            "autosize": "none",
            "config": {
                "background": "white"
            },

            "title": {
                "text": ["Average Reward (per token) for Each Lever"],
                "fontSize": tfSize,
                "offset": tfSize,
                "color": plotColor,
                "dx": 20
            },

            "signals": [
                { "name": "cx", "update": "width / 2" },
                { "name": "cy", "update": "height / 2" },
                { "name": "radius", "value": 4 },
                { "name": "collide", "value": 1 },
                { "name": "gravityX", "value": 0.01 },
                { "name": "gravityY", "value": 0.02 },
                { "name": "static", "value": false }
            ],

            "data": [
                {
                    "name": "people",
                    "url": `data/${datafile}.json`,
                    "format": {"type": "json", "property": "nodes"}
                },
                {
                    "name": "averages",
                    "values": avgValues
                }
            ],

            "scales": [
                {
                    "name": "xscale",
                    "type": "band",
                    "domain": {
                        "data": "people",
                        "field": "group",
                        "sort": true
                    },
                    "range": "width"
                },
                {
                    "name": "yscale",
                    "type": "linear",
                    "domain": [0,4],
                    "range": "height"
                },
                {
                    "name": "color",
                    "type": "ordinal",
                    "domain": {"data": "people", "field": "group"},
                    "range": {"scheme": [dotColor, dotColor]}
                }
            ],
            "axes": [
                {
                    "title": 'Lever Name',
                    "titleFontSize": afSize,
                    "labelFontSize": afSize,
                    "orient": "bottom", 
                    "scale": "xscale" 
                },
                { 
                    "title": 'Reward (per token)',
                    "titleFontSize": afSize,
                    "labelFontSize": afSize,
                    "values": [0,1,2,3,4],
                    "orient": "left", 
                    "scale": "yscale" 
                }
            ],

            "marks": [
                {
                    "name": "nodes",
                    "type": "symbol",
                    "from": {"data": "people"},
                    "encode": {
                        "enter": {
                            "fill": {"scale": "color", "field": "group"},
                            "x": {"scale": "xscale", "field": "group", "band": 0.5},
                            "y": {"scale": "yscale", "field": "value"}
                        },
                        "update": {
                            "size": {"signal": "pow(2 * radius, 2)"},
                            "stroke": {"value": "white"},
                            "strokeWidth": {"value": 1},
                            "zindex": {"value": 0}
                        },
                        
                    },
                    "transform": [
                        {
                        "type": "force",
                        "iterations": 300,
                        "static": {"signal": "static"},
                        "forces": [
                            {"force": "collide", "iterations": {"signal": "collide"}, "radius": {"signal": "radius"}},
                            // {"force": "x", "x": "x", "strength": {"signal": "gravityX"}},
                            // {"force": "y", "y": "y", "strength": {"signal": "gravityY"}}
                        ]
                        }
                    ]
                },
                {
                    "type": "rule",
                    "from": {"data": "averages"},
                    "encode": {
                        "update": {
                            "color": plotColor,
                            // "size": {"value": 10},
                            "strokeWidth": {"value": 4},
                            "x": {"scale": "xscale", "field": "x", "band": 0.27},
                            "x2": {"scale": "xscale", "field": "x", "band": 0.73},
                            "y": {"scale": "yscale", "field": "y", "type": "quantitative"}
                        },
                        
                    },
                },
                {
                    "type": "text",
                    "from": {"data": "averages"},
                    "encode": {
                        "update": {
                            "fill": {"value": "#333"},
                            "x": {"scale": "xscale", "field": "x", "band": 0.5, "offset": -120},
                            "y": {"scale": "yscale", "field": "y", "type": "quantitative", "offset": -10},
                            "text": {"value": "average", "fontWeight": "bold"},
                            "fontSize": {"value": 16}
                        },
                        
                    },
                    
                },
            ]
            }


        // Embed the visualization in the container with id `vis`
        vegaEmbed('#vis', vlSpec);
    </script>
  </body>
</html>
