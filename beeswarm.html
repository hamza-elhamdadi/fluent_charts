<!doctype html>
<html>
  <head>
    <title>Vega-Lite Bar Chart</title>
    <meta charset="utf-8" />

    <script src="https://cdn.jsdelivr.net/npm/vega@5.30.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5.21.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6.26.0"></script>

    <style media="screen">
      /* Add space between Vega-Embed links  */
      .vega-actions a {
        margin-right: 5px;
      }
    </style>
  </head>
  <body>
    <!-- <h1>Template for Embedding Vega-Lite Visualization</h1> -->
    <!-- Container for the visualization -->
    <div id="vis"></div>


    <script>
        let plotColor = "#555";
        let dotColor = "#888";
        // let plotColor = "#ddd";

        let datafile = "al";

        // let data = [
        //     // positive levers
        //     [ {name: 'First Class', reward: 1}, {name: 'Seventh Heaven', reward: 3} ],
        //     [ {name: 'First Class', reward: 3}, {name: 'Seventh Heaven', reward: 1} ],
        //     // negative levers
        //     [ {name: 'Abduction', reward: 1}, {name: 'Motormouth', reward: 3} ],
        //     [ {name: 'Abduction', reward: 3}, {name: 'Motormouth', reward: 1} ],
        //     // neutral levers
        //     [ {name: 'A', reward: 1}, {name: 'B', reward: 3} ],
        //     [ {name: 'B', reward: 1}, {name: 'A', reward: 3} ]
        // ]


        let i = 5

        let plotWidth = 800, plotHeight = 400, tfSize = 20,  afSize = 18;
        // let plotWidth = 264, plotHeight = 132, tfSize = 6.6, afSize = 5.94;

        // Assign the specification to a local variable vlSpec.
        var vlSpec = {
            "$schema": "https://vega.github.io/schema/vega/v5.json",
            "description": "A beeswarm chart example that uses a force-directed layout to group items by category.",
            "width": plotWidth,
            "height": plotHeight,
            "padding": {"left": 25, "right": 5, "top": 100, "bottom": 20},
            "autosize": "none",

            "title": {
                text: ["Average Reward (per token) for Each Lever"],
                fontSize: tfSize,
                offset: tfSize,
                color: plotColor
            },

            "signals": [
                { "name": "cx", "update": "width / 2" },
                { "name": "cy", "update": "height / 2" },
                { "name": "radius", "value": 4 },
                { "name": "collide", "value": 10 },
                { "name": "gravityX", "value": 0.2 },
                { "name": "gravityY", "value": 0.1 },
                { "name": "static", "value": true }
            ],

            "data": [
                {
                "name": "people",
                "url": `data/${datafile}.json`,
                "format": {"type": "json", "property": "nodes"}
                }
            ],

            "scales": [
                {
                    "name": "xscale",
                    "type": "band",
                    "domain": {
                        "data": "people",
                        "field": "group",
                        "sort": true
                    },
                    "range": "width"
                },
                {
                    "name": "yscale",
                    "type": "linear",
                    "domain": {
                        "data": "people",
                        "field": "value"
                    },
                    "range": "height"
                },
                {
                    "name": "color",
                    "type": "ordinal",
                    "domain": {"data": "people", "field": "group"},
                    "range": {"scheme": [dotColor, dotColor]}
                }
            ],
            "axes": [
                { "orient": "bottom", "scale": "xscale" },
                { "orient": "left", "scale": "yscale" }
            ],

            "marks": [
                {
                    "name": "nodes",
                    "type": "symbol",
                    "from": {"data": "people"},
                    "encode": {
                        "enter": {
                        "fill": {"scale": "color", "field": "group"},
                        "xfocus": {"scale": "xscale", "field": "group", "band": 0.5},
                        "yfocus": {"scale": "yscale", "field": "value"}
                        },
                        "update": {
                            "size": {"signal": "pow(2 * radius, 2)"},
                            "stroke": {"value": "white"},
                            "strokeWidth": {"value": 1},
                            "zindex": {"value": 0}
                        },
                        
                    },
                    "transform": [
                        {
                        "type": "force",
                        "iterations": 300,
                        "static": {"signal": "static"},
                        "forces": [
                            {"force": "collide", "iterations": {"signal": "collide"}, "radius": {"signal": "radius"}},
                            {"force": "x", "x": "xfocus", "strength": {"signal": "gravityX"}},
                            {"force": "y", "y": "yfocus", "strength": {"signal": "gravityY"}}
                        ]
                        }
                    ]
                },
                {
                    "type": "rule",
                    "from": {"data": "people"},
                    "encode": {
                        "enter": {
                            "color": plotColor,
                            "size": 10,
                            "x": {"scale": "xscale", "field": "group"},
                            "y": {"scale": "yscale", "field": "value", "type": "quantitative", "aggregate": "mean"}
                        },
                        
                    },
                }
            ]
            }


        // Embed the visualization in the container with id `vis`
        vegaEmbed('#vis', vlSpec);
    </script>
  </body>
</html>
